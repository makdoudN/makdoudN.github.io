{{ if not .Site.Params.disableHighlightJS }}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  
  <style>
    pre {
        position: relative;
        background: #1a1a1a;
        border-radius: 8px;
        margin: 1.5em 0;
    }

    .code-header {
        position: absolute;
        top: 8px;
        right: 8px;
        z-index: 2;
    }

    .copy-button {
        font-size: 12px;
        color: #888;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        padding: 4px 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        opacity: 0.6;
    }

    pre:hover .copy-button {
        opacity: 1;
    }

    .copy-button:hover {
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.2);
    }

    .copy-button.copied {
        background: #28a745;
        color: white;
        border-color: transparent;
    }

    pre code {
        display: block;
        padding: 16px;
        overflow-x: auto;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 14px;
        line-height: 1.5;
    }

    pre code::-webkit-scrollbar {
        height: 8px;
    }

    pre code::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }

    pre code::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
    }

    pre code::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
      });

      document.querySelectorAll('pre').forEach((block) => {
        const header = document.createElement('div');
        header.className = 'code-header';
        
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        
        button.addEventListener('click', async () => {
          const code = block.querySelector('code');
          try {
            await navigator.clipboard.writeText(code.textContent);
            button.textContent = 'Copied!';
            button.classList.add('copied');
            
            setTimeout(() => {
              button.textContent = 'Copy';
              button.classList.remove('copied');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        });
        
        header.appendChild(button);
        block.insertBefore(header, block.firstChild);
      });
    });
  </script>
{{ end }}